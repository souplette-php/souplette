{#
    @see https://html.spec.whatwg.org/multipage/parsing.html#markup-declaration-open-state
#}
{% import 'tokenizer/_macros.php.twig' as h -%}

if (strpos($this->input, '--', $this->position) === $this->position) {
    // Consume those two characters
    $this->position += 1;
    // create a comment token whose data is the empty string,
    $this->currentToken = new Token(TokenTypes::COMMENT, '');
    // and switch to the comment start state.
    {{ h.advance_to('COMMENT_START') }}
} elseif (stripos($this->input, 'DOCTYPE', $this->position) === $this->position) {
    // Consume those characters
    $this->position += 7;
    // and switch to the DOCTYPE state.
    {{ h.advance_to('DOCTYPE') }}
} elseif (strpos($this->input, '[CDATA[', $this->position) === $this->position) {
    // Consume those characters.
    $this->position += 7;
    if (false) {
        // TODO: If there is an adjusted current node and it is not an element in the HTML namespace,
        // https://html.spec.whatwg.org/multipage/parsing.html#adjusted-current-node
        // then switch to the CDATA section state.
        {{ h.advance_to('CDATA_SECTION') }}
    } else {
        // TODO: this is a cdata-in-html-content parse error.
        // Create a comment token whose data is the "[CDATA[" string.
        $this->currentToken = new Token(TokenTypes::COMMENT, '[CDATA[');
        // Switch to the bogus comment state.
        {{ h.advance_to('BOGUS_COMMENT') }}
    }
} else {
    // TODO: This is an incorrectly-opened-comment parse error.
    // Create a comment token whose data is the empty string.
    $this->currentToken = new Token(TokenTypes::COMMENT, '');
    // Switch to the bogus comment state (don't consume anything in the current state).
    {{ h.reconsume_in('BOGUS_COMMENT') }}
}
